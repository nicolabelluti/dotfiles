- name: Prepare the base environment
  hosts: localhost
  connection: local
  gather_facts: false

  pre_tasks:
    - name: 'Ensure the "chezmoi" variable is set'
      ansible.builtin.assert:
        that:
          - chezmoi is not undefined
          - chezmoi is mapping
        fail_msg: 'Pass with: --extra-vars "$(chezmoi data --format=json)"'

  roles:
    - role: shell
      when: features.shell == true
